<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Food Ordering</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/pocketbase@latest/dist/pocketbase.umd.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #111827; /* bg-slate-900 */
            color: #f3f4f6; /* text-slate-100 */
        }
        .modal {
            display: none; /* Hidden by default */
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.7);
            backdrop-filter: blur(4px);
            align-items: center;
            justify-content: center;
        }
        .modal.active {
            display: flex;
        }
        .modal-content {
            background-color: #1f2937; /* bg-slate-800 */
            margin: auto;
            padding: 20px;
            border: 1px solid #374151; /* border-slate-700 */
            border-radius: 0.5rem; /* rounded-lg */
            box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1), 0 4px 6px -2px rgba(0,0,0,0.05);
            width: 90%;
            max-width: 600px; /* default, can be overridden */
            max-height: 90vh;
            display: flex;
            flex-direction: column;
        }
        .modal-header {
            padding: 1rem 1.25rem; /* p-4 p-5 */
            border-bottom: 1px solid #374151; /* border-slate-700 */
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .modal-body {
            padding: 1.5rem; /* p-6 */
            overflow-y: auto;
        }
        .modal-footer {
            padding: 1rem 1.25rem;
            border-top: 1px solid #374151;
            display: flex;
            justify-content: flex-end;
            gap: 0.75rem; /* space-x-3 */
        }
        .sidebar {
            transition: transform 0.3s ease-in-out;
        }
        @media (max-width: 1023px) { /* lg breakpoint */
            .sidebar.hidden-mobile {
                transform: translateX(-100%);
            }
            .sidebar.open-mobile {
                transform: translateX(0);
            }
        }
        /* Custom scrollbar for modal and sidebar */
        .modal-body::-webkit-scrollbar, .sidebar-nav::-webkit-scrollbar {
            width: 6px;
        }
        .modal-body::-webkit-scrollbar-track, .sidebar-nav::-webkit-scrollbar-track {
            background: #374151; /* slate-700 */
        }
        .modal-body::-webkit-scrollbar-thumb, .sidebar-nav::-webkit-scrollbar-thumb {
            background: #4b5563; /* slate-600 */
            border-radius: 3px;
        }
        .modal-body::-webkit-scrollbar-thumb:hover, .sidebar-nav::-webkit-scrollbar-thumb:hover {
            background: #6b7280; /* slate-500 */
        }
        .table-responsive {
            overflow-x: auto;
        }
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1050;
            padding: 1rem;
            border-radius: 0.375rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
            opacity: 0;
            transform: translateY(-20px);
        }
        .notification.show {
            opacity: 1;
            transform: translateY(0);
        }
        .notification-success {
            background-color: #059669; /* bg-emerald-600 */
            color: white;
        }
        .notification-error {
            background-color: #dc2626; /* bg-red-600 */
            color: white;
        }

        /* Loader styles */
        .loader-overlay {
            position: fixed;
            inset: 0;
            background-color: rgba(17, 24, 39, 0.8); /* bg-slate-900 with opacity */
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000; /* Higher than modals */
        }
        .loader {
            border: 4px solid #4b5563; /* border-slate-600 */
            border-top: 4px solid #10b981; /* border-emerald-500 */
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>

    <div id="loaderOverlay" class="loader-overlay hidden">
        <div class="loader"></div>
    </div>

    <div id="notificationArea"></div>

    <div id="loginPage" class="min-h-screen flex items-center justify-center bg-gradient-to-br from-slate-900 to-slate-800 p-4">
        <div class="bg-slate-800 p-8 rounded-xl shadow-2xl w-full max-w-md border border-slate-700">
            <div class="text-center mb-8">
                <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="mx-auto text-emerald-400 lucide lucide-shopping-bag"><path d="M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z"/><path d="M3 6h18"/><path d="M16 10a4 4 0 0 1-8 0"/></svg>
                <h1 class="text-4xl font-bold text-white mt-4">Admin Dashboard</h1>
                <p class="text-slate-400 mt-2">Acesso Restrito</p>
            </div>
            <form id="loginForm" class="space-y-6">
                <div>
                    <label for="email" class="block text-sm font-medium text-slate-300">Email</label>
                    <input id="email" name="email" type="email" autocomplete="email" required
                           class="mt-1 block w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-lg shadow-sm placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 text-white sm:text-sm"
                           placeholder="seu.email@exemplo.com">
                </div>
                <div>
                    <label for="password" class="block text-sm font-medium text-slate-300">Senha</label>
                    <div class="mt-1 relative">
                        <input id="password" name="password" type="password" autocomplete="current-password" required
                               class="block w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-lg shadow-sm placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 text-white sm:text-sm"
                               placeholder="********">
                        <button type="button" id="togglePassword"
                                class="absolute inset-y-0 right-0 pr-3 flex items-center text-sm leading-5 text-slate-400 hover:text-slate-200"
                                aria-label="Mostrar senha">
                            <svg id="eyeIcon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"/><circle cx="12" cy="12" r="3"/></svg>
                            <svg id="eyeOffIcon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="hidden"><path d="M9.88 9.88a3 3 0 1 0 4.24 4.24"/><path d="M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68"/><path d="M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61"/><line x1="2" x2="22" y1="2" y2="22"/></svg>
                        </button>
                    </div>
                </div>
                <div id="loginError" class="hidden bg-red-900/50 border border-red-700 text-red-300 px-4 py-3 rounded-lg items-center space-x-2">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" x2="12" y1="8" y2="12"/><line x1="12" x2="12.01" y1="16" y2="16"/></svg>
                    <p class="text-sm"></p>
                </div>
                <div>
                    <button type="submit" id="loginButton"
                            class="w-full flex justify-center py-3 px-4 border border-transparent rounded-lg shadow-sm text-sm font-medium text-white bg-emerald-600 hover:bg-emerald-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-slate-800 focus:ring-emerald-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-150">
                        Entrar
                    </button>
                </div>
            </form>
            <p class="mt-6 text-center text-xs text-slate-500">
                Use suas credenciais de administrador do PocketBase.
            </p>
        </div>
    </div>

    <div id="dashboardPage" class="hidden min-h-screen flex flex-col">
        <header class="bg-slate-800 shadow-md sticky top-0 z-30 border-b border-slate-700">
            <div class="container mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex items-center justify-between h-16">
                    <div class="flex items-center">
                        <button id="sidebarToggle" class="lg:hidden text-slate-400 hover:text-white focus:outline-none mr-4" aria-label="Toggle sidebar">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="3" x2="21" y1="12" y2="12"/><line x1="3" x2="21" y1="6" y2="6"/><line x1="3" x2="21" y1="18" y2="18"/></svg>
                        </button>
                        <div class="flex-shrink-0 flex items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="h-8 w-auto text-emerald-400"><path d="M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z"/><path d="M3 6h18"/><path d="M16 10a4 4 0 0 1-8 0"/></svg>
                            <span class="ml-3 text-2xl font-semibold text-white">Admin</span>
                        </div>
                    </div>
                    <div class="flex items-center">
                        <span id="userEmailDisplay" class="text-slate-300 text-sm mr-3 hidden sm:block"></span>
                        <button id="logoutButton" class="flex items-center text-slate-400 hover:text-emerald-400 hover:bg-slate-700 px-3 py-2 rounded-md text-sm font-medium transition-colors" aria-label="Sair">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-1"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" x2="9" y1="12" y2="12"/></svg>
                            Sair
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <div class="flex flex-1">
            <aside id="sidebar" class="sidebar hidden-mobile fixed inset-y-0 left-0 z-40 flex flex-col bg-slate-800 w-64 border-r border-slate-700 lg:static lg:translate-x-0 lg:inset-auto lg:w-64">
                <div class="flex items-center justify-between h-16 px-4 border-b border-slate-700 lg:hidden">
                    <div class="flex items-center">
                         <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="h-8 w-auto text-emerald-400"><path d="M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z"/><path d="M3 6h18"/><path d="M16 10a4 4 0 0 1-8 0"/></svg>
                        <span class="ml-3 text-xl font-semibold text-white">Admin</span>
                    </div>
                    <button id="sidebarCloseButton" class="text-slate-400 hover:text-white" aria-label="Fechar sidebar">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" x2="6" y1="6" y2="18"/><line x1="6" x2="18" y1="6" y2="18"/></svg>
                    </button>
                </div>
                <nav class="sidebar-nav flex-1 px-2 py-4 space-y-1 overflow-y-auto">
                    <a href="#products" class="group sidebar-link flex items-center px-3 py-3 text-sm font-medium rounded-md transition-colors bg-emerald-600 text-white">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-3 flex-shrink-0 h-5 w-5 text-white"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
                        Produtos
                    </a>
                 </nav>
                <div class="p-4 border-t border-slate-700 mt-auto">
                    <p class="text-xs text-slate-500">&copy; <span id="currentYear"></span> FoodOrdering Admin</p>
                </div>
            </aside>
             <div id="sidebarOverlay" class="fixed inset-0 z-30 bg-black/50 lg:hidden hidden" aria-hidden="true"></div>

            <main class="flex-1 overflow-y-auto p-4 sm:p-6 lg:p-8">
                <div class="flex flex-col sm:flex-row justify-between items-center mb-6 gap-4">
                    <h2 class="text-3xl font-bold text-white">Gerenciar Produtos</h2>
                    <button id="addProductButton" class="flex items-center bg-emerald-600 hover:bg-emerald-700 text-white font-semibold py-2 px-4 rounded-lg shadow-md transition-colors duration-150">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2"><line x1="12" x2="12" y1="5" y2="19"/><line x1="5" x2="19" y1="12" y2="12"/></svg>
                        Adicionar Produto
                    </button>
                </div>

                <div id="productTableContainer" class="table-responsive bg-slate-800 shadow-lg rounded-lg border border-slate-700">
                    <table class="min-w-full divide-y divide-slate-700">
                        <thead class="bg-slate-700/50">
                            <tr>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-slate-300 uppercase tracking-wider">Imagem</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-slate-300 uppercase tracking-wider">Título</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-slate-300 uppercase tracking-wider">Categoria</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-slate-300 uppercase tracking-wider">Preço</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-slate-300 uppercase tracking-wider">Descrição</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-slate-300 uppercase tracking-wider">Status</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-slate-300 uppercase tracking-wider">Ações</th>
                            </tr>
                        </thead>
                        <tbody id="productTableBody" class="divide-y divide-slate-700">
                            <tr><td colspan="7" class="text-center text-slate-400 py-10 text-lg">Carregando produtos...</td></tr>
                        </tbody>
                    </table>
                </div>
            </main>
        </div>
    </div>

    <div id="productModal" class="modal">
        <div class="modal-content max-w-2xl">
            <div class="modal-header">
                <h3 id="modalTitle" class="text-xl font-semibold text-white">Adicionar Produto</h3>
                <button id="closeProductModal" class="p-1 rounded-full text-slate-400 hover:text-white hover:bg-slate-700 transition-colors" aria-label="Fechar modal">
                     <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" x2="6" y1="6" y2="18"/><line x1="6" x2="18" y1="6" y2="18"/></svg>
                </button>
            </div>
            <form id="productForm" class="modal-body space-y-5 text-sm">
                <input type="hidden" id="productId" name="productId">
                <div id="productFormError" class="hidden bg-red-900/50 border border-red-700 text-red-300 px-4 py-3 rounded-lg items-center space-x-2">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" x2="12" y1="8" y2="12"/><line x1="12" x2="12.01" y1="16" y2="16"/></svg>
                    <p class="text-sm"></p>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                    <div>
                        <label for="productTitle" class="block font-medium text-slate-300">Título do Produto*</label>
                        <input type="text" name="title" id="productTitle" required class="mt-1 block w-full bg-slate-700 border-slate-600 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-emerald-500 focus:border-emerald-500 text-white">
                    </div>
                    <div>
                        <label for="productPrice" class="block font-medium text-slate-300">Preço (R$)*</label>
                        <input type="number" name="price" id="productPrice" required step="0.01" class="mt-1 block w-full bg-slate-700 border-slate-600 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-emerald-500 focus:border-emerald-500 text-white">
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                    <div>
                        <label for="productCategory" class="block font-medium text-slate-300">Categoria*</label>
                        <select name="category" id="productCategory" required class="mt-1 block w-full bg-slate-700 border-slate-600 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-emerald-500 focus:border-emerald-500 text-white">
                            <option value="" disabled>Selecione uma categoria</option>
                            <option value="Lanche">Lanche</option>
                            <option value="Bebidas">Bebidas</option>
                            <option value="Promoção">Promoção</option>
                        </select>
                    </div>
                    <div>
                        <label for="productIsAvailable" class="block font-medium text-slate-300">Disponível*</label>
                        <select name="isAvailable" id="productIsAvailable" required class="mt-1 block w-full bg-slate-700 border-slate-600 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-emerald-500 focus:border-emerald-500 text-white">
                            <option value="true">Sim</option>
                            <option value="false">Não</option>
                        </select>
                    </div>
                </div>
                <div>
                    <label for="productDescription" class="block font-medium text-slate-300">Descrição</label>
                    <textarea name="description" id="productDescription" rows="3" class="mt-1 block w-full bg-slate-700 border-slate-600 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-emerald-500 focus:border-emerald-500 text-white"></textarea>
                </div>
                <div>
                    <label for="productImgText" class="block font-medium text-slate-300">Imagem (Nome do arquivo ou URL)</label>
                    <input type="text" name="imgText" id="productImgText" placeholder="ex: nome_da_imagem.jpg ou https://..." class="mt-1 block w-full bg-slate-700 border-slate-600 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-emerald-500 focus:border-emerald-500 text-white">
                    <label for="productImgFile" class="mt-2 block font-medium text-slate-300">Ou enviar novo arquivo:</label>
                    <input type="file" name="imgFile" id="productImgFile" accept="image/*" class="mt-1 block w-full text-sm text-slate-400 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-emerald-500 file:text-white hover:file:bg-emerald-600">
                    <div id="imagePreviewContainer" class="mt-2">
                        <p id="currentImageText" class="text-xs text-slate-400 mb-1 hidden">Imagem atual:</p>
                        <img id="imagePreview" src="#" alt="Pré-visualização da Imagem" class="hidden h-20 w-auto rounded border border-slate-600">
                    </div>
                </div>
                <div>
                    <label for="productOptions" class="block font-medium text-slate-300">Opções (JSON Array)</label>
                    <textarea name="options" id="productOptions" rows="4" placeholder='Ex: [{"name": "Tamanho", "type": "radio", "values": ["Pequeno", "Médio (+R$2.00)"]}]' class="mt-1 block w-full bg-slate-700 border-slate-600 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-emerald-500 focus:border-emerald-500 text-white font-mono text-xs"></textarea>
                    <p class="mt-1 text-xs text-slate-400">Insira um array JSON válido para as opções do produto. Ex: []</p>
                </div>
                <div class="modal-footer">
                    <button type="button" id="cancelProductForm" class="px-4 py-2 text-sm font-medium text-slate-300 bg-slate-700 hover:bg-slate-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-slate-800 focus:ring-slate-500 transition-colors">
                        Cancelar
                    </button>
                    <button type="submit" id="submitProductForm" class="px-4 py-2 text-sm font-medium text-white bg-emerald-600 hover:bg-emerald-700 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-slate-800 focus:ring-emerald-500 disabled:opacity-50 transition-colors">
                        Salvar
                    </button>
                </div>
            </form>
        </div>
    </div>

<script>
    // Variáveis de configuração da API e Coleções
    const POCKETBASE_URL = 'http://localhost:8090'; // Altere para a URL do seu PocketBase se for diferente
    const COLLECTION_NAME_PRODUCTS = 'food_collection'; // Confirme o nome da sua coleção de produtos
    const COLLECTION_NAME_ADMINS = '_admins'; // Coleção padrão de administradores do PocketBase
    let pb; // Instância do PocketBase

    // Elementos do DOM
    let loginPage, dashboardPage, loginForm, loginError, loginButton, emailInput, passwordInput, togglePasswordButton, eyeIcon, eyeOffIcon;
    let userEmailDisplay, logoutButton, addProductButton, productTableBody, productModal, modalTitle, productForm, productFormError, productIdInput, closeProductModalButton, cancelProductFormButton, submitProductFormButton;
    let productTitleInput, productPriceInput, productCategoryInput, productDescriptionInput, productImgTextInput, productImgFileInput, imagePreview, imagePreviewContainer, currentImageText, productOptionsInput, productIsAvailableInput; // Adicionado productIsAvailableInput
    let sidebar, sidebarToggle, sidebarCloseButton, sidebarOverlay;
    let loaderOverlay;

    // Estado da aplicação (simplificado)
    let currentEditingProductId = null;

    // Inicialização do PocketBase SDK
    try {
        pb = new window.PocketBase(POCKETBASE_URL);
    } catch (e) {
        console.error("PocketBase SDK não carregou. Verifique a inclusão do script.", e);
        alert("Erro crítico: SDK do PocketBase não encontrado. O admin não funcionará.");
    }

    // Funções Utilitárias
    function showLoader() {
        if(loaderOverlay) loaderOverlay.classList.remove('hidden');
    }
    function hideLoader() {
        if(loaderOverlay) loaderOverlay.classList.add('hidden');
    }

    function displayNotification(message, type = 'success', duration = 3000) {
        const notificationArea = document.getElementById('notificationArea');
        if (!notificationArea) return;
        const notificationId = 'notification-' + Date.now();
        const notificationDiv = document.createElement('div');
        notificationDiv.id = notificationId;
        notificationDiv.className = `notification ${type === 'success' ? 'notification-success' : 'notification-error'}`;

        let iconSvg = '';
        if (type === 'success') {
            iconSvg = `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="inline mr-2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>`;
        } else {
            iconSvg = `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="inline mr-2"><circle cx="12" cy="12" r="10"/><line x1="12" x2="12" y1="8" y2="12"/><line x1="12" x2="12.01" y1="16" y2="16"/></svg>`;
        }
        notificationDiv.innerHTML = `${iconSvg} ${message}`;

        notificationArea.appendChild(notificationDiv);

        setTimeout(() => {
            notificationDiv.classList.add('show');
        }, 10);

        setTimeout(() => {
            notificationDiv.classList.remove('show');
            setTimeout(() => {
                notificationDiv.remove();
            }, 300);
        }, duration);
    }


    // Funções de Autenticação
    async function handleLogin(event) {
        event.preventDefault();
        showLoader();
        loginError.classList.add('hidden');
        loginButton.disabled = true;
        loginButton.innerHTML = '<svg class="animate-spin h-5 w-5 text-white mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>';

        try {
            // Autenticar como administrador
            const authData = await pb.admins.authWithPassword(
                emailInput.value,
                passwordInput.value
            );
            updateAuthState();
        } catch (err) {
            console.error('Login failed:', err);
            loginError.querySelector('p').textContent = err.message || 'Credenciais inválidas ou erro no servidor.';
            loginError.classList.remove('hidden');
            loginError.classList.add('flex');
        } finally {
            hideLoader();
            loginButton.disabled = false;
            loginButton.innerHTML = 'Entrar';
        }
    }

    function handleLogout() {
        showLoader();
        pb.authStore.clear();
        if(emailInput) emailInput.value = '';
        if(passwordInput) passwordInput.value = '';
        updateAuthState();
        hideLoader();
    }

    function updateAuthState() {
        // Verifica se o usuário autenticado é um administrador
        const isAdmin = pb.authStore.isValid && pb.authStore.model && pb.authStore.model.id;

        loginPage.classList.toggle('hidden', isAdmin);
        loginPage.classList.toggle('flex', !isAdmin);
        dashboardPage.classList.toggle('hidden', !isAdmin);
        dashboardPage.classList.toggle('flex', isAdmin);

        if (isAdmin) {
            userEmailDisplay.textContent = `Olá, ${pb.authStore.model.email}`;
            fetchProducts();
        } else {
            if (productTableBody) productTableBody.innerHTML = '<tr><td colspan="7" class="text-center text-slate-400 py-10 text-lg">Faça login para ver os produtos.</td></tr>';
        }
    }

    function checkInitialAuth() {
        updateAuthState();
    }

    // Funções CRUD de Produtos
    async function fetchProducts() {
        if (!pb.authStore.isValid) return;
        showLoader();
        productTableBody.innerHTML = '<tr><td colspan="7" class="text-center text-slate-400 py-10 text-lg">Carregando produtos...</td></tr>';
        try {
            const resultList = await pb.collection(COLLECTION_NAME_PRODUCTS).getList(1, 100, { // Ajuste a paginação conforme necessário
                sort: '-created',
            });
            renderProductTable(resultList.items);
        } catch (err) {
            console.error('Failed to fetch products:', err);
            productTableBody.innerHTML = `<tr><td colspan="7" class="text-center text-red-400 py-10 text-lg">Falha ao carregar produtos: ${err.message}</td></tr>`;
            displayNotification(`Falha ao carregar produtos: ${err.message}`, 'error');
        } finally {
            hideLoader();
        }
    }

    function renderProductTable(products) {
        productTableBody.innerHTML = '';
        if (products.length === 0) {
            productTableBody.innerHTML = '<tr><td colspan="7" class="text-center text-slate-400 py-10 text-lg">Nenhum produto cadastrado.</td></tr>';
            return;
        }

        products.forEach(product => {
            const row = productTableBody.insertRow();
            row.className = 'hover:bg-slate-700/30 transition-colors';
            row.dataset.productId = product.id;

            let imageUrl = 'https://placehold.co/100x100/334155/475569?text=Sem+Img&font=Inter';
            if (product.img) {
                 if (product.img.startsWith('http://') || product.img.startsWith('https://')) {
                    imageUrl = product.img;
                 } else {
                    // Usar a thumbnail se configurada, ou a imagem original
                    // Exemplo de thumbnail: ?thumb=100x100
                    imageUrl = `${POCKETBASE_URL}/api/files/${product.collectionId || COLLECTION_NAME_PRODUCTS}/${product.id}/${product.img}`;
                 }
            }
            // Define isAvailable como true se não estiver definido (para compatibilidade com produtos antigos)
            const isAvailable = product.isAvailable === undefined ? true : product.isAvailable;

            row.innerHTML = `
                <td class="px-6 py-4 whitespace-nowrap">
                    <img src="${imageUrl}" alt="${product.title || 'Imagem do produto'}" class="h-12 w-12 rounded-md object-cover border border-slate-600 product-image-in-table" onerror="this.onerror=null;this.src='https://placehold.co/100x100/334155/475569?text=Erro&font=Inter';">
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-white">${product.title || '-'}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-300">${product.category || '-'}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-300">R$ ${Number(product.price || 0).toFixed(2).replace('.', ',')}</td>
                <td class="px-6 py-4 text-sm text-slate-400 max-w-xs truncate" title="${product.description || ''}">${product.description || '-'}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-300">
                    ${isAvailable
                        ? '<span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-emerald-700 text-emerald-100">Disponível</span>'
                        : '<span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-red-700 text-red-100">Indisponível</span>'
                    }
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium space-x-1">
                    <button class="toggle-availability-btn p-2 rounded-md hover:bg-slate-700 transition-colors ${isAvailable ? 'text-yellow-400 hover:text-yellow-300' : 'text-green-400 hover:text-green-300'}"
                            data-id="${product.id}" data-current-status="${isAvailable}"
                            title="${isAvailable ? 'Marcar como Indisponível' : 'Marcar como Disponível'}">
                        ${isAvailable
                            ? '<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-eye-off"><path d="M9.88 9.88a3 3 0 1 0 4.24 4.24"/><path d="M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68"/><path d="M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61"/><line x1="2" x2="22" y1="2" y2="22"/></svg>'
                            : '<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-eye"><path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"/><circle cx="12" cy="12" r="3"/></svg>'
                        }
                    </button>
                    <button class="edit-product-btn text-emerald-400 hover:text-emerald-300 p-2 rounded-md hover:bg-slate-700 transition-colors" data-id="${product.id}" title="Editar">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
                    </button>
                    <button class="delete-product-btn text-red-500 hover:text-red-400 p-2 rounded-md hover:bg-slate-700 transition-colors" data-id="${product.id}" title="Excluir">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></svg>
                    </button>
                </td>
            `;
        });

        document.querySelectorAll('.edit-product-btn').forEach(button => {
            button.addEventListener('click', () => openProductModal(products.find(p => p.id === button.dataset.id)));
        });
        document.querySelectorAll('.delete-product-btn').forEach(button => {
            button.addEventListener('click', () => handleDeleteProduct(button.dataset.id));
        });
        document.querySelectorAll('.toggle-availability-btn').forEach(button => {
            button.addEventListener('click', () => {
                const productId = button.dataset.id;
                const currentStatus = button.dataset.currentStatus === 'true'; // Convert string to boolean
                handleToggleAvailability(productId, currentStatus);
            });
        });
    }

    async function handleToggleAvailability(productId, currentStatus) {
        showLoader();
        const newStatus = !currentStatus;
        try {
            await pb.collection(COLLECTION_NAME_PRODUCTS).update(productId, {
                isAvailable: newStatus
            });
            displayNotification(`Produto ${newStatus ? 'ativado' : 'desativado'} com sucesso!`, 'success');
            fetchProducts(); // Recarrega a lista para mostrar a alteração
        } catch (err) {
            console.error('Failed to toggle product availability:', err);
            displayNotification(`Falha ao alterar disponibilidade: ${err.message}`, 'error');
        } finally {
            hideLoader();
        }
    }


    function openProductModal(product = null) {
        currentEditingProductId = product ? product.id : null;
        productForm.reset();
        productFormError.classList.add('hidden');
        productFormError.querySelector('p').textContent = '';
        imagePreview.classList.add('hidden');
        imagePreview.src = '#';
        currentImageText.classList.add('hidden');
        productImgFileInput.value = '';

        // Selecionar o campo isAvailable aqui, pois ele está dentro do modal
        const productIsAvailableField = document.getElementById('productIsAvailable');

        if (product) {
            modalTitle.textContent = 'Editar Produto';
            submitProductFormButton.textContent = 'Salvar Alterações';
            productIdInput.value = product.id;
            productTitleInput.value = product.title || '';
            productPriceInput.value = product.price || 0;
            productCategoryInput.value = product.category || '';
            productDescriptionInput.value = product.description || '';
            productImgTextInput.value = product.img || '';
            productOptionsInput.value = product.options ? (typeof product.options === 'string' ? product.options : JSON.stringify(product.options, null, 2)) : '[]';
            productIsAvailableField.value = product.isAvailable === undefined ? 'true' : String(product.isAvailable);


            if (product.img) {
                let imageUrl = product.img;
                if (!(product.img.startsWith('http://') || product.img.startsWith('https://'))) {
                    imageUrl = `${POCKETBASE_URL}/api/files/${product.collectionId || COLLECTION_NAME_PRODUCTS}/${product.id}/${product.img}`;
                }
                imagePreview.src = imageUrl;
                imagePreview.classList.remove('hidden');
                currentImageText.classList.remove('hidden');
            }

        } else {
            modalTitle.textContent = 'Adicionar Novo Produto';
            submitProductFormButton.textContent = 'Adicionar Produto';
            productIdInput.value = '';
            productCategoryInput.value = ""; // Default to empty for new product
            productIsAvailableField.value = 'true'; // Default para novos produtos
        }
        productModal.classList.add('active');
    }

    function closeProductModal() {
        productModal.classList.remove('active');
    }

    async function handleProductFormSubmit(event) {
        event.preventDefault();
        showLoader();
        submitProductFormButton.disabled = true;
        submitProductFormButton.innerHTML = '<svg class="animate-spin h-5 w-5 text-white mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>';
        productFormError.classList.add('hidden');

        let parsedOptions;
        try {
            parsedOptions = JSON.parse(productOptionsInput.value || '[]');
            if (!Array.isArray(parsedOptions)) throw new Error("Opções devem ser um array JSON.");
        } catch (error) {
            productFormError.querySelector('p').textContent = "Formato inválido para 'Opções'. Deve ser um JSON array válido (ex: [] ou [{\"name\":\"Tamanho\", ...}]).";
            productFormError.classList.remove('hidden');
            productFormError.classList.add('flex');
            hideLoader();
            submitProductFormButton.disabled = false;
            submitProductFormButton.textContent = currentEditingProductId ? 'Salvar Alterações' : 'Adicionar Produto';
            return;
        }

        const productIsAvailableField = document.getElementById('productIsAvailable');

        const dataPayload = new FormData();
        dataPayload.append('title', productTitleInput.value);
        dataPayload.append('price', parseFloat(productPriceInput.value));
        dataPayload.append('category', productCategoryInput.value);
        dataPayload.append('description', productDescriptionInput.value);
        dataPayload.append('options', JSON.stringify(parsedOptions));
        dataPayload.append('isAvailable', productIsAvailableField.value === 'true'); // Converte string para boolean

        const imageFile = productImgFileInput.files[0];
        const imgTextValue = productImgTextInput.value.trim();

        if (imageFile) {
            dataPayload.append('img', imageFile);
        } else if (imgTextValue === '' && currentEditingProductId) {
            // Se o campo de texto da imagem estiver vazio E estiver editando,
            // significa que o usuário pode querer remover a imagem.
            // Para o PocketBase remover um arquivo, você pode enviar `null` para o campo.
            // No entanto, se o campo imgText for usado para URLs, essa lógica pode precisar de ajuste.
            // Se img for obrigatório e não pode ser null, omita o append ou envie uma string vazia
            // dependendo da configuração do campo no PocketBase.
            // Para este exemplo, vamos assumir que enviar null remove a imagem.
            dataPayload.append('img', null);
        } else if (imgTextValue) {
            dataPayload.append('img', imgTextValue);
        }
        // Se nem imageFile nem imgTextValue for fornecido e for um novo produto,
        // o campo 'img' simplesmente não será enviado, e o PocketBase usará o valor padrão
        // ou marcará como erro se for obrigatório.

        try {
            if (currentEditingProductId) {
                await pb.collection(COLLECTION_NAME_PRODUCTS).update(currentEditingProductId, dataPayload);
                displayNotification('Produto atualizado com sucesso!', 'success');
            } else {
                await pb.collection(COLLECTION_NAME_PRODUCTS).create(dataPayload);
                displayNotification('Produto adicionado com sucesso!', 'success');
            }
            closeProductModal();
            fetchProducts();
        } catch (err) {
            console.error('Failed to save product:', err.data || err);
            let errorMessage = 'Erro ao salvar produto.';
            if (err.data && err.data.data) {
                const fieldErrors = Object.entries(err.data.data).map(([field, errorDetail]) => {
                    return `${field}: ${errorDetail.message}`;
                }).join('; ');
                if (fieldErrors) errorMessage += ` Detalhes: ${fieldErrors}`;
            } else if (err.message) {
                errorMessage = err.message;
            }
            productFormError.querySelector('p').textContent = errorMessage;
            productFormError.classList.remove('hidden');
            productFormError.classList.add('flex');
            displayNotification(`Erro ao salvar: ${errorMessage}`, 'error', 5000);
        } finally {
            hideLoader();
            submitProductFormButton.disabled = false;
            submitProductFormButton.textContent = currentEditingProductId ? 'Salvar Alterações' : 'Adicionar Produto';
        }
    }

    async function handleDeleteProduct(productId) {
        if (window.confirm('Tem certeza que deseja excluir este produto? Esta ação não pode ser desfeita.')) {
            showLoader();
            try {
                await pb.collection(COLLECTION_NAME_PRODUCTS).delete(productId);
                displayNotification('Produto excluído com sucesso!', 'success');
                fetchProducts();
            } catch (err) {
                console.error('Failed to delete product:', err);
                displayNotification(`Falha ao excluir produto: ${err.message}`, 'error');
            } finally {
                hideLoader();
            }
        }
    }

    function handleImagePreview(event) {
        const file = event.target.files[0];
        if (file) {
            const oldObjectURL = imagePreview.src;
            imagePreview.src = URL.createObjectURL(file);
            imagePreview.classList.remove('hidden');
            currentImageText.classList.add('hidden');
            productImgTextInput.value = ''; // Limpa o campo de texto se um arquivo for selecionado

            // Revoga o Object URL anterior se ele foi criado por createObjectURL
            if (oldObjectURL && oldObjectURL.startsWith('blob:')) {
                URL.revokeObjectURL(oldObjectURL);
            }
        } else {
            // Se o input de arquivo for limpo, restaura a imagem com base no productImgTextInput se houver
            const imgTextVal = productImgTextInput.value.trim();
            if (currentEditingProductId && imgTextVal) {
                 let originalImageUrl = imgTextVal;
                 if (!(originalImageUrl.startsWith('http://') || originalImageUrl.startsWith('https://'))) {
                    const record = (productTableBody.querySelector(`tr[data-product-id="${currentEditingProductId}"]`))
                        ? pb.collection(COLLECTION_NAME_PRODUCTS).getOne(currentEditingProductId, { fields: 'collectionId,id,img' }).then(p => {
                            if (p && p.img) {
                                imagePreview.src = `${POCKETBASE_URL}/api/files/${p.collectionId || COLLECTION_NAME_PRODUCTS}/${p.id}/${p.img}`;
                                imagePreview.classList.remove('hidden');
                                currentImageText.classList.remove('hidden');
                            } else {
                                imagePreview.classList.add('hidden'); currentImageText.classList.add('hidden');
                            }
                        }).catch(() => { imagePreview.classList.add('hidden'); currentImageText.classList.add('hidden');})
                        : (() => { imagePreview.classList.add('hidden'); currentImageText.classList.add('hidden');})();

                 } else {
                    imagePreview.src = originalImageUrl;
                    imagePreview.classList.remove('hidden');
                    currentImageText.classList.remove('hidden');
                 }
            } else {
                const oldObjectURL = imagePreview.src;
                imagePreview.classList.add('hidden');
                imagePreview.src = '#';
                currentImageText.classList.add('hidden');
                if (oldObjectURL && oldObjectURL.startsWith('blob:')) {
                    URL.revokeObjectURL(oldObjectURL);
                }
            }
        }
    }

    document.addEventListener('DOMContentLoaded', () => {
        loginPage = document.getElementById('loginPage');
        dashboardPage = document.getElementById('dashboardPage');
        loginForm = document.getElementById('loginForm');
        loginError = document.getElementById('loginError');
        loginButton = document.getElementById('loginButton');
        emailInput = document.getElementById('email');
        passwordInput = document.getElementById('password');
        togglePasswordButton = document.getElementById('togglePassword');
        eyeIcon = document.getElementById('eyeIcon');
        eyeOffIcon = document.getElementById('eyeOffIcon');

        userEmailDisplay = document.getElementById('userEmailDisplay');
        logoutButton = document.getElementById('logoutButton');
        addProductButton = document.getElementById('addProductButton');
        productTableBody = document.getElementById('productTableBody');

        productModal = document.getElementById('productModal');
        modalTitle = document.getElementById('modalTitle');
        productForm = document.getElementById('productForm');
        productFormError = document.getElementById('productFormError');
        productIdInput = document.getElementById('productId');
        closeProductModalButton = document.getElementById('closeProductModal');
        cancelProductFormButton = document.getElementById('cancelProductForm');
        submitProductFormButton = document.getElementById('submitProductForm');

        productTitleInput = document.getElementById('productTitle');
        productPriceInput = document.getElementById('productPrice');
        productCategoryInput = document.getElementById('productCategory');
        productDescriptionInput = document.getElementById('productDescription');
        productImgTextInput = document.getElementById('productImgText');
        productImgFileInput = document.getElementById('productImgFile');
        imagePreview = document.getElementById('imagePreview');
        imagePreviewContainer = document.getElementById('imagePreviewContainer');
        currentImageText = document.getElementById('currentImageText');
        productOptionsInput = document.getElementById('productOptions');
        // productIsAvailableInput será pego dentro das funções openProductModal e handleProductFormSubmit
        // pois ele faz parte do DOM do modal que pode não estar sempre visível ou renderizado da mesma forma.

        sidebar = document.getElementById('sidebar');
        sidebarToggle = document.getElementById('sidebarToggle');
        sidebarCloseButton = document.getElementById('sidebarCloseButton');
        sidebarOverlay = document.getElementById('sidebarOverlay');

        loaderOverlay = document.getElementById('loaderOverlay');

        document.getElementById('currentYear').textContent = new Date().getFullYear();

        if (loginForm) loginForm.addEventListener('submit', handleLogin);
        if (logoutButton) logoutButton.addEventListener('click', handleLogout);
        if (addProductButton) addProductButton.addEventListener('click', () => openProductModal(null));
        if (productForm) productForm.addEventListener('submit', handleProductFormSubmit);

        if (closeProductModalButton) closeProductModalButton.addEventListener('click', closeProductModal);
        if (cancelProductFormButton) cancelProductFormButton.addEventListener('click', closeProductModal);
        if (productModal) productModal.addEventListener('click', (e) => {
            if (e.target === productModal) { // Fecha modal se clicar no overlay
                closeProductModal();
            }
        });
        if (productImgFileInput) productImgFileInput.addEventListener('change', handleImagePreview);

        if (togglePasswordButton) {
            togglePasswordButton.addEventListener('click', () => {
                const isPassword = passwordInput.type === 'password';
                passwordInput.type = isPassword ? 'text' : 'password';
                eyeIcon.classList.toggle('hidden', isPassword);
                eyeOffIcon.classList.toggle('hidden', !isPassword);
                togglePasswordButton.setAttribute('aria-label', isPassword ? 'Ocultar senha' : 'Mostrar senha');
            });
        }

        if (sidebarToggle) {
            sidebarToggle.addEventListener('click', () => {
                sidebar.classList.remove('hidden-mobile');
                sidebar.classList.add('open-mobile');
                sidebarOverlay.classList.remove('hidden');
            });
        }
        if (sidebarCloseButton) {
            sidebarCloseButton.addEventListener('click', () => {
                sidebar.classList.remove('open-mobile');
                sidebar.classList.add('hidden-mobile');
                sidebarOverlay.classList.add('hidden');
            });
        }
        if (sidebarOverlay) {
             sidebarOverlay.addEventListener('click', () => {
                sidebar.classList.remove('open-mobile');
                sidebar.classList.add('hidden-mobile');
                sidebarOverlay.classList.add('hidden');
            });
        }
        document.querySelectorAll('.sidebar-link').forEach(link => {
            link.addEventListener('click', () => {
                 if (window.innerWidth < 1024) {
                    sidebar.classList.remove('open-mobile');
                    sidebar.classList.add('hidden-mobile');
                    sidebarOverlay.classList.add('hidden');
                 }
            });
        });

        if (pb) {
            checkInitialAuth();
        } else {
            console.error("PocketBase não foi inicializado corretamente no DOMContentLoaded.");
            if(loginPage) loginPage.innerHTML = '<p class="text-red-500 text-center p-10">Erro crítico ao carregar a aplicação. Verifique o console.</p>';
        }
    });

</script>
</body>
</html>